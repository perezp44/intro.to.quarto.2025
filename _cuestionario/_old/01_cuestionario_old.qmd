---
title: "Cuestionario"
subtitle: "Ejercicios para el curso [Escribiendo con R y Quarto](https://perezp44.github.io/intro.to.quarto/){target='blank'}"
#abstract:
toc-title: √çndice
from: markdown+emoji  #- usar emojis https://gist.github.com/rxaviers/7360908
---

::: {.callout-note icon="false" collapse="true"}
####### Contexto

Este cuestionario, confeccionado para el curso {{< var my_curso >}} contiene cuestiones y ejercicios para recordar, trabajar y profundizar en los conceptos e ideas vistos durante los 2 primeros d√≠as del curso.

El curso es una introducci√≥n a Quarto en el que vemos como generar documentos (tutoriales, slides, webs ...) con contenido estad√≠stico generado con R. 

Los ejercicios se han pensado para resolver en el Qproject "quarto.ejercicios" que puedes descargarte [aqu√≠](./cuestionario/quarto.ejercicios.zip){target="_blank"}

:::

<br>

------------------------------------------------------------------------

<br>

# 0. An√°lisis con R

::: {.callout-note icon="false" collapse="true"}
####### Contexto/Objetivo

Igual algunos de vosotros no sab√©is mucho R, pero en este `Ejercicio 0`** os proporciono c√≥digo R para hacer un an√°lisis** gr√°fico sobre una relaci√≥n econ√≥mica, la [curva de Phillips](https://es.wikipedia.org/wiki/Curva_de_Phillips), con datos de inflaci√≥n y desempleo de la OCDE.

No es preocup√©is por el c√≥digo R, s√≥lo vamos a ejecutarlo para que ve√°is que lo que hace es cargar unos datos, trabajarlos y crear un par de visualizaciones: s√≥lo es una excusa, una forma de practicar la creaci√≥n de documentos con Quarto.
:::

### 0.A (1¬™ parte)

------------------------------------------------------------------------

**Pega el siguiente c√≥digo R en un script** (fichero .R) llamado `ejercicio_00.R` y ejecuta el c√≥digo

::: {.callout-warning icon="false" collapse="true"}
#### :warning: Intalaci√≥n paquetes

-   Para que te funcione el script necesitar√°s tener instalados varios paquetes de R:

``` r
install.packages("pak")
pak::pak(c("tidyverse", "ggtext",  "curl", "perezp44/pjpv.curso.R.2022"))
```
:::

::: {.callout-warning icon="false" collapse="true"}
##### C√≥digo R (0.A)

``` r
#- ejercicio_00 (PRIMERA PARTE del script) -------------------------------------
#- Thom-Ivar van Dijk hizo un gr√°fico chul√≠simo sobre la curva de Phillips
#- https://twitter.com/ThomIvar/status/1516114838996631563
#- source: https://github.com/TIvanDijk/pRojects/blob/main/30DayChartChallenge/oecd.R
#- Los datos de Thom-Ivar van Dijk (@ThomIvar)
#- ruta_inflation <- "https://raw.githubusercontent.com/TIvanDijk/pRojects/main/30DayChartChallenge/other/oecd_inflation.csv"
#- inflation <- rio::import(ruta_inflation)
#- ruta_unemployment <- "https://raw.githubusercontent.com/TIvanDijk/pRojects/main/30DayChartChallenge/other/oecd_unemployment.csv"
#- unemployment <- readr::read_csv(ruta_unemployment)

#- Para quien no sepa qu√© es la curva de Phillips
#- Curva de Phillips: https://en.wikipedia.org/wiki/Phillips_curve
#- https://www.lavanguardia.com/economia/20220605/8317351/inflacion-paro.html


#- Vamos a replicar su chul√≠simo gr√°fico (con datos actualizados y para m√°s pa√≠ses)
library(tidyverse)
library(ggtext)

#- Para descargar datos de inflaci√≥n y tasa de desempleo podemos usar el pkg "eurostat" o "OECD" o ...
#- my_table <- "prc_hicp_manr"        #- inflaci√≥n de eurostat
#- web de la OCDE: http://stats.oecd.org/
#- library(OECD)   #- pkg OECD: https://github.com/expersso/OECD
# dataset_list <- OECD::get_datasets()  #- df con listado de datos disponibles en OECD (1.526)
# aa <- OECD::search_dataset("unemployment") #- b√∫squeda de datos sobre "unemployment" (10)

#- Vamos a utilizar los mimso datos q usa @ThomIvar PERO actualizados


#- Datos -----------------------------------------------------------------------
#- Inflaci√≥n de la OCDE -
#- web: https://data.oecd.org/price/inflation-cpi.htm
url_inflation <- "https://stats.oecd.org/sdmx-json/data/DP_LIVE/.CPI.../OECD?contentType=csv&detail=code&separator=comma&csv-lang=en"
ruta_inflation <- "./pruebas/DP_LIVE_22032023113248591.csv"
# curl::curl_download(url_inflation, ruta_inflation)
# download.file(url_inflation, ruta_inflation)
inflation_orig <- readr::read_csv(ruta_inflation)
inflation_dicc <- pjpv.curso.R.2022::pjp_dicc(inflation_orig)

#- Desempleo de la OCDE -
# web:: https://data.oecd.org/unemp/unemployment-rate.htm
url_unemployment <- "https://stats.oecd.org/sdmx-json/data/DP_LIVE/.HUR.../OECD?contentType=csv&detail=code&separator=comma&csv-lang=en"
ruta_unemployment <- "./pruebas/DP_LIVE_12042023090537614.csv"
# curl::curl_download(url_unemployment, ruta_unemployment)
unemployment_orig <- readr::read_csv(ruta_unemployment)
unemployment_dicc <- pjpv.curso.R.2022::pjp_dicc(unemployment_orig)

#- seleccionamos datos ---------------------------------------------------------
inflation <- inflation_orig %>%
  dplyr::filter(FREQUENCY == "M" & MEASURE == "AGRWTH", SUBJECT == "TOT") %>%
  select(place = LOCATION, date = TIME, cpi = Value)

unemployment <- unemployment_orig %>%
  dplyr::filter(FREQUENCY == 'M', SUBJECT == 'TOT') %>%
  select(place = LOCATION, date = TIME, rate = Value)

#- fusionamos los 2 df's -------------------------------------------------------
df <- left_join(inflation, unemployment) %>%
       tidyr::drop_na() %>%
       dplyr::mutate(group = case_when(
           str_starts(date, "199") ~ "1991-1999",
           str_starts(date, "200") ~ "2000-2009",
           str_starts(date, "201") ~ "2010-2019",
           str_starts(date, "202") ~ ">= 2020",
           TRUE ~ "other" )) %>%
      dplyr::filter(group != "other")

#- plot 1 pais -----------------------------------------------------------------
#- plot con datos de 1 pa√≠s (G-7) y 2 periodos (2000-2019)
my_country <- c("ESP")
my_country <- c("G-7")  #- seleccionamos "pa√≠s"
my_periodos <- c("2000-2009", "2010-2019") #- seleccionamos periodos
my_title <- glue::glue("What happened to the <b>Phillips Curve</b> in ", my_country  , "? (thanks to <b style='color:#fd5532'>@ThomIvar</b>)")
my_title



df_1p <- df %>%
  dplyr::filter(place == my_country) %>%
  dplyr::filter(group %in% my_periodos)


# -- make plot for 1 country
p0 <- ggplot(df_1p, aes(x = rate, y = cpi, group = group, color = group)) +
        geom_point(alpha = 0.5, size = 2.25)
p0

p1 <- p0 + geom_smooth(method = 'lm', se = FALSE, linetype = 2) +
  scale_color_manual(values = c('#d1495b', '#00798c')) +
  annotate('text', x = 5.5, y = 3.75, label = '2000-2009', color = '#d1495b',
           family = 'American Typewriter', fontface = 'bold') +
  annotate('text', x = 4.5, y = 0.75, label = '2010-2019', color = '#00798c',
           family = 'American Typewriter', fontface = 'bold') +
  labs(title = my_title,
       subtitle = "The Phillips curve is an economic concept that states that inflation
       and unemployment have a stable and inverse relationship. According to this concept,
       lower unemployment rates cause firms to raise wages to attract new labor,
       which increases the inflation rate. However, in the <b style='color:#00798c'>
       last decade</b> this relationship appears to have vanished.",
       caption = '@ThomIvar ‚Ä¢ source: OECD (monthly, G7 countries)',
       x = 'Unemployment rate, %',
       y = 'Inflation rate, %') +
  theme_void() +
  theme(text = element_text('American Typewriter', color = 'grey30'),
    legend.position = 'none',
    plot.title = element_textbox_simple(size = 20, margin = margin(b = 0.15, unit = 'cm')),
    plot.subtitle = element_textbox_simple(size = 11, color = 'grey60',
                                           margin = margin(b = 0.25, unit = 'cm')),
    plot.background = element_rect(fill = '#fffef7', color = '#fffef7'),
    plot.caption = element_text(size = 10, color = 'grey80'),
    plot.margin = margin(1, 1, 1, 1, 'cm'),
    panel.grid = element_line(color = 'grey70', linetype = 'dotted'),
    axis.title = element_text(margin = margin(t = 0.2, r = 0.2, unit = 'cm'), color = 'grey50'),
    axis.title.y = element_text(angle = 90),
    axis.text = element_text(color = 'grey70', size = 9,
                             margin = margin(t = 0.1, r = 0.1, unit = 'cm')),
    axis.line = element_line(color = 'grey50'),
    axis.ticks = element_line(color = 'grey50', size = 0.6),
    axis.ticks.length = unit(0.10, 'cm'))

p1
#ggsave("./imagenes/oecd.png", width = 9.5, height = 6)
```
:::

### 0.B (2¬™ parte)

------------------------------------------------------------------------

El `ejercicio_00.R` tiene una segunda parte, as√≠ que copia el siguiente c√≥digo R al final del script `ejercicio_00.R` y ejecuta el c√≥digo

::: {.callout-warning icon="false" collapse="true"}
##### C√≥digo R (0.B)

``` r
#- ejercicio_00 (SEGUNDA PARTE del script) -------------------------------------
#- hacemos el gr√°fico para varios pa√≠ses ---------------------------------------
my_paises <- c("ESP", "FRA", "GBR", "DEU", "USA", "JPN")
my_periodos <- c("2000-2009", "2010-2019") 

df_paises <- df %>%  
  dplyr::filter(place %in% my_paises) %>% 
  dplyr::filter(group %in% my_periodos)

#- plot feo para luego hacer un facetting
p0 <- ggplot(df_paises, aes(x = rate, y = cpi, color = group)) +
  geom_point(alpha = 0.5, size = 0.75) +
  geom_smooth(method = 'lm', se = FALSE, linetype = 1) +
  scale_color_manual(values = c(  '#d1495b', '#00798c', '#099205','#8e0592'))

p0

p0 +  facet_wrap(vars(place))

p1 <- p0 +
  facet_wrap(vars(place), scales = "free")  +
  labs(title = "What happened to the <b>Phillips Curve</b>? ",
       subtitle = "The Phillips curve is an economic concept that states that inflation
       and unemployment have a stable and inverse relationship. According to this concept,
       lower unemployment rates cause firms to raise wages to attract new labor,
       which increases the inflation rate. However, this is not always case for the <b style='color:#d1495b'>
       2000-2009</b> decade, not in the <b style='color:#00798c'>
       last decade (2010-2019) </b>. This relationship appears to have vanished!!",
       caption = "@pjpv4444  (thanks to  @ThomIvar) ‚Ä¢ source: OECD (monthly, G7 countries)",
       x = 'Unemployment rate, %',
       y = 'Inflation rate, %') +
  theme_void() +
  theme(text = element_text('American Typewriter', color = 'grey30'),
    legend.position = 'none',
    plot.title = element_textbox_simple(size = 20, margin = margin(b = 0.15, unit = 'cm')),
    plot.subtitle = element_textbox_simple(size = 11, color = 'grey60',
                                           margin = margin(b = 0.25, unit = 'cm')),
    plot.background = element_rect(fill = '#fffef7', color = '#fffef7'),
    plot.caption = element_text(size = 10, color = 'grey80'),
    plot.margin = margin(1, 1, 1, 1, 'cm'),
    panel.grid = element_line(color = 'grey70', linetype = 'dotted'),
    axis.title = element_text(margin = margin(t = 0.2, r = 0.2, unit = 'cm'), color = 'grey50'),
    axis.title.y = element_text(angle = 90),
    axis.text = element_text(color = 'grey70', size = 9,
                             margin = margin(t = 0.1, r = 0.1, unit = 'cm')),
    axis.line = element_line(color = 'grey50'),
    axis.ticks = element_line(color = 'grey50', linewidth = 0.6),
    axis.ticks.length = unit(0.10, 'cm'))


p1
```
:::

<br>

------------------------------------------------------------------------

<br>

# 1. Documentos con QMD

::: {.callout-note icon="false" collapse="false"}
####### Objetivo

Recordar c√≥mo **escribir en QMD** para crear documentos html. Para ello usamos el c√≥digo R que os he proporcionado en el ejercicio anterior sobre la [curva de Phillips](https://es.wikipedia.org/wiki/Curva_de_Phillips).

Se trata de que hag√°is lo siguiente:
:::

### 1.A (informe b√°sico)

------------------------------------------------------------------------

Una vez hemos comprobado que el c√≥digo de `ejercicio_00.R` nos funciona y tenemos una idea general sobre lo que hace, vamos a confeccionar un informe para mostrar el an√°lisis que hemos realizado. As√≠ que la tarea esta clara: **hay que redactar un informe** (reproducible) que describa y muestre lo que hacemos en el `ejercicio_00.R`. M√°s abajo os doy instrucciones m√°s precisas para confeccionar el informe.

::: {.callout-note icon="false" collapse="true"}
####### Instrucciones para confeccionar el informe

Vamos a generar un **informe b√°sico** en formato html que describa lo que hemos hecho en el `ejercicio_00.R`.

Indicaciones:

-   El documento fuente (source document) que generar√° el informe final ha de llamarse `ejercicio_01.qmd`

-   Informe en formato html, con t√≠tulo y autor.

-   El informe tendr√° las siguientes secciones de primer nivel: Intro, Marco te√≥rico, Datos y Resultados

-   La secci√≥n de datos tendr√° 2 sub-secciones: Inflaci√≥n y Desempleo

-   El informe ha de contener: p√°rrafos, una imagen, enlaces, una cita, una nota al pie, texto en negrita, una ecuaci√≥n y una tabla

-   No te preocupes por lo que escribes, preoc√∫pate s√≥lo de la sintaxis y elementos de Quarto.
:::

Evidentemente, sabr√≠as hacer el informe, solo que necesitar√≠as tiempo. As√≠ que mejor si empiezas, lo intentas un poco, ya veremos cuanto (¬ø3-4 minutos?) y una vez lo hayas intentado usas lo siguiente:

::: {.callout-warning icon="false" collapse="true"}
####### Ayudita

``` yaml
---
title: "Curva de Phillips, ¬øsigue siendo v√°lida?"
author: Nosotros
format: html
---

# Intro

# Marco te√≥rico

# Datos 

## Inflaci√≥n 

## Desempleo

# Resultados
```
:::

::: {.callout-warning icon="false" collapse="true"}
####### Ayuda gorda

```{r}
#| echo: false
#| warning: false
#| class-output: "sourceCode r"

cat(readLines("./ejercicios_cuestionario/ejercicio_01.qmd"), sep = "\n")
```

:::

### 1.B (tuneando el informe)

------------------------------------------------------------------------

Una vez hemos hecho un informe b√°sico con Quarto, vamos a mejorarlo. M√°s abajo os doy instrucciones m√°s precisas para tunear el informe.

::: {.callout-note icon="false" collapse="true"}
####### Instrucciones para tunear el informe

Indicaciones:

-   Para preservar el documento fuente del informe original, guarda una copia con el nombre `ejercicio_01_tuneado.qmd`

-   Pon TOC a la derecha

-   Pon las opciones (las que puedas) de los chunks en el YAML. Aprovecha y haz que no se muestren los mensajes y los warnings que quedan muy feos en el informe final

-   Haz que los chunks sean expandibles

-   Que se pueda descargar el documento fuente

-   ....
:::

Evidentemente, sabr√≠as tunear el informe, solo que necesitar√≠as tiempo. As√≠ que mejor si empiezas, lo intentas un poco, ya veremos cuanto (¬ø3 minutos?) y una vez lo hayas intentado (pero fuerte) usas lo siguiente:

::: {.callout-warning icon="false" collapse="true"}
####### Ayudita

Puedes usar el yaml que ves m√°s abajo. Est√° un poco cargadito, pero se trata de recordar algunas de las opciones que tenemos en el YAML

``` yaml
---
title: "Curva de Phillips, ¬øsigue siendo v√°lida?"
subtitle: "Ejercicio del curso [Escribiendo con R y Quarto](https://perezp44.github.io/intro.to.quarto/){target='blank'}"
abstract: Los gr√°ficos parecen indicar que durante el periodo 2010-2020 no se mantiene la relaci√≥n postulada por Phillips, aunque ... y ...
date: 2023-01-02
date-modified: last-modified
author:
  - name: Pedro J. P√©rez
    url: https://perezp44.github.io/pjperez.web/
    affiliation: Universitat de Val√®ncia
    affiliation-url: https://www.uv.es
    orcid: 0000-0001-9375-6330
categories: [reproducibilidad]
from: markdown+emoji  #- usar emojis https://gist.github.com/rxaviers/7360908
format:
  html:
    page-layout: full
    backgroundcolor: "#F1F3F4"
    theme: 
      - litera #sketchy #slate #- litera  superhero darkly cosmo
      - assets/ember.scss
    css: 
      - assets/styles.css
    toc: true
    toc-title: √çndice
    toc-depth: 3
    toc-location: right
    code-line-numbers: true
    code-copy: true
    code-overflow: scroll    #- {wrap, scroll}
    code-fold: show
    code-tools: false
    code-link: true
    
execute:
  freeze: true  # re-render only when source changes
  echo: true
  message: false
  warning: false
  eval: true
  
knitr:
  opts_knit: 
    fig-width: 6
    fig-asp: 0.618
  
embed-resources: true
---
```
:::

<br>

------------------------------------------------------------------------

<br>

# 2. Slides con QMD

::: {.callout-note icon="false" collapse="false"}
####### Objetivo

Recordar c√≥mo crear **slides con Quarto**. Para ello partiremos del informe que hemos creado en el `ejercicio_01`

Se trata de que hag√°is lo siguiente:
:::

### 2.A (slides b√°sicas)

------------------------------------------------------------------------

Utiliza el documento `ejercicio_01.qmd` para generar unas **Revealjs slides** sobre nuestro informe de la inflaci√≥n. El archivo que generar√° las slides ll√°malo `ejercicio_02.qmd`

Evidentemente sabes hacer las slides, int√©ntalo fuerte (3-4 minutos) y luego mira las ayudas:

::: {.callout-warning icon="false" collapse="true"}
####### Ayudita

Solo tienes que (desde RStudio) crear un fichero para presentaci√≥n (File \> New File \> Quarto Presentation). Se crear√° un fichero con este yaml:

``` yaml
---
title: "Untitled"
format: revealjs
---
```

Luego solo tendr√°s que copiar el contenido de `ejercicio_01.qmd`. Quedar√° algo como:

::: {.callout-warning icon="false" collapse="true"}
####### Primera versi√≥n de las slides

```{r}
#| echo: false
#| warning: false
#| class-output: "sourceCode r"

cat(readLines("./ejercicios_cuestionario/ejercicio_02.qmd"), sep = "\n")
```
:::
:::

Utilizando la ayudita, salen unas slides, **PERO** no muy bien, porque hay contenido que no se ve: tenemos que dedicar un poco de tiempo a ver como separamos el contenido en slides. Una posibilidad es hacerlo como puedes ver en la siguiente ayuda.

::: {.callout-warning icon="false" collapse="true"}
####### Ayuda (segunda versi√≥n de las slides)

He resumido el contenido del informe y lo he partido en slides. Me ha quedado algo como:

```{r}
#| echo: false
#| warning: false
#| class-output: "sourceCode r"

cat(readLines("./ejercicios_cuestionario/ejercicio_02_v2.qmd"), sep = "\n")
```

A√∫n necesitan m√°s trabajo pero en un aprieto podr√≠an valer üòâüòâ
:::

### 2.B (tuneando las slides)

Una vez hemos hecho unas slides b√°sicas **vamos a mejorarlas**. M√°s abajo os doy instrucciones m√°s precisas para tunear las slides

::: {.callout-note icon="false" collapse="true"}
####### Instrucciones para tunear las slides

Indicaciones:

-   cambia el color de una p√°gina

-   ....
:::

Evidentemente, sabr√≠as tunear las slides, solo que necesitar√≠as tiempo. As√≠ que mejor si empiezas, lo intentas un poco, ya veremos cuanto (¬ø3 minutos?) y una vez lo hayas intentado (pero fuerte) usas lo siguiente:

::: {.callout-warning icon="false" collapse="true"}
####### Ayudita

``` yaml
---
title: "Curva de Phillips, ¬øsigue siendo v√°lida?"
author: Nosotros
format: html
---
```
:::

<br>

------------------------------------------------------------------------

<br>

# 3. Web/Blog con Quarto

::: {.callout-note icon="false" collapse="true"}
####### Contexto/Objetivo

Hemos hecho un an√°lisis que parece poner en cuesti√≥n la validez de la curva de Phillips y estamos tan orgullosos de nuestro an√°lisis que, hasta que podamos publicarlo en un Journal, queremos que lo conozca todo el mundo, as√≠ que decidimos crear una web para presentarlos al mundo. üòú üòú

Por supuesto esto es un ejercicio para practicar lo que vimos en el segundo d√≠a del curso pero ... igual nos hacemos famosos con nuestra web sobre Phillips!!
:::



### 1.A (Web b√°sica)

------------------------------------------------------------------------

Vamos a crear una web para mostrar al mundo nuestros hallazgos sobre la curva de Phillips. Abajo tienes las intrucciones

::: {.callout-note icon="false" collapse="true"}
####### Instrucciones para confeccionar la web

Nuestra web deber√° tener los siguientes contenidos/estructura

Indicaciones:

- En la barra de navegaci√≥n de be haber un link a nuestro informe y otro enlace a nuestras slides

- footer

- CV
:::

Evidentemente, sabr√≠as hacer el informe, solo que necesitar√≠as tiempo. As√≠ que mejor si empiezas, lo intentas un poco, ya veremos cuanto (¬ø5 minutos?) y una vez lo hayas intentado (pero fuerte) usas lo siguiente:

::: {.callout-warning icon="false" collapse="true"}
####### Ayudita

``` yaml
---
title: "Curva de Phillips, ¬øsigue siendo v√°lida?"
author: Nosotros
format: html
---
:::












<br>

------------------------------------------------------------------------

<br>

# 4. T√≥picos "avanzados"

-   Informes parametrizados etc ....
